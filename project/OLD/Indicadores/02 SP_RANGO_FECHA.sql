USE gorilla
GO


SET NOCOUNT ON

DECLARE @rango_size TINYINT
DECLARE @i SMALLINT, @j SMALLINT, @desde SMALLINT, @hasta SMALLINT
DECLARE @numero_sorteos SMALLINT

CREATE TABLE #TEMP_RANGO_VALUES
	(desde SMALLINT,
	hasta SMALLINT
	)

CREATE TABLE #TEMP_RESULTS
(
	[DESDE] SMALLINT
	,[HASTA] SMALLINT
	,[OCURRENCIA] INT
	,[% OCURRENCIA] MONEY
	,[MARTES (A partir 10/05/2011)] SMALLINT
	,[Viernes (A partir 10/05/2011)] SMALLINT
	,[INVIERNO] SMALLINT  --DEFAULT 0
	,[PRIMAVERA] SMALLINT
	,[VERANO] SMALLINT
	,[OTONO] SMALLINT
	,[ABR2004] SMALLINT --DEFAULT 0
	,[MAY2004] SMALLINT --DEFAULT 0
	,[JUN2004] SMALLINT --DEFAULT 0
	,[JUL2004] SMALLINT
	,[AGO2004] SMALLINT
	,[SEP2004] SMALLINT
	,[OCT2004] SMALLINT
	,[NOV2004] SMALLINT
	,[DIC2004] SMALLINT
	,[ENE2005] SMALLINT --DEFAULT 0
	,[FEB2005] SMALLINT --DEFAULT 0
	,[MAR2005] SMALLINT --DEFAULT 0
	,[APR2005] SMALLINT --DEFAULT 0
	,[MAY2005] SMALLINT --DEFAULT 0
	,[JUN2005] SMALLINT --DEFAULT 0
	,[JUL2005] SMALLINT
	,[AGO2005] SMALLINT
	,[SEP2005] SMALLINT
	,[OCT2005] SMALLINT
	,[NOV2005] SMALLINT
	,[DIC2005] SMALLINT
	,[ENE2006] SMALLINT --DEFAULT 0
	,[FEB2006] SMALLINT --DEFAULT 0
	,[MAR2006] SMALLINT --DEFAULT 0
	,[APR2006] SMALLINT --DEFAULT 0
	,[MAY2006] SMALLINT --DEFAULT 0
	,[JUN2006] SMALLINT --DEFAULT 0
	,[JUL2006] SMALLINT
	,[AGO2006] SMALLINT
	,[SEP2006] SMALLINT
	,[OCT2006] SMALLINT
	,[NOV2006] SMALLINT
	,[DIC2006] SMALLINT
	,[ENE2007] SMALLINT --DEFAULT 0
	,[FEB2007] SMALLINT --DEFAULT 0
	,[MAR2007] SMALLINT --DEFAULT 0
	,[APR2007] SMALLINT --DEFAULT 0
	,[MAY2007] SMALLINT --DEFAULT 0
	,[JUN2007] SMALLINT --DEFAULT 0
	,[JUL2007] SMALLINT
	,[AGO2007] SMALLINT
	,[SEP2007] SMALLINT
	,[OCT2007] SMALLINT
	,[NOV2007] SMALLINT
	,[DIC2007] SMALLINT
	,[ENE2008] SMALLINT --DEFAULT 0
	,[FEB2008] SMALLINT --DEFAULT 0
	,[MAR2008] SMALLINT --DEFAULT 0
	,[APR2008] SMALLINT --DEFAULT 0
	,[MAY2008] SMALLINT --DEFAULT 0
	,[JUN2008] SMALLINT --DEFAULT 0
	,[JUL2008] SMALLINT
	,[AGO2008] SMALLINT
	,[SEP2008] SMALLINT
	,[OCT2008] SMALLINT
	,[NOV2008] SMALLINT
	,[DIC2008] SMALLINT
	,[ENE2009] SMALLINT --DEFAULT 0
	,[FEB2009] SMALLINT --DEFAULT 0
	,[MAR2009] SMALLINT --DEFAULT 0
	,[APR2009] SMALLINT --DEFAULT 0
	,[MAY2009] SMALLINT --DEFAULT 0
	,[JUN2009] SMALLINT --DEFAULT 0
	,[JUL2009] SMALLINT
	,[AGO2009] SMALLINT
	,[SEP2009] SMALLINT
	,[OCT2009] SMALLINT
	,[NOV2009] SMALLINT
	,[DIC2009] SMALLINT
	,[ENE2010] SMALLINT --DEFAULT 0
	,[FEB2010] SMALLINT --DEFAULT 0
	,[MAR2010] SMALLINT --DEFAULT 0
	,[APR2010] SMALLINT --DEFAULT 0
	,[MAY2010] SMALLINT --DEFAULT 0
	,[JUN2010] SMALLINT --DEFAULT 0
	,[JUL2010] SMALLINT
	,[AGO2010] SMALLINT
	,[SEP2010] SMALLINT
	,[OCT2010] SMALLINT
	,[NOV2010] SMALLINT
	,[DIC2010] SMALLINT
	,[ENE2011] SMALLINT --DEFAULT 0
	,[FEB2011] SMALLINT --DEFAULT 0
	,[MAR2011] SMALLINT --DEFAULT 0
	,[APR2011] SMALLINT --DEFAULT 0
	,[MAY2011] SMALLINT --DEFAULT 0
	,[JUN2011] SMALLINT --DEFAULT 0
	,[JUL2011] SMALLINT
	,[AGO2011] SMALLINT
	,[SEP2011] SMALLINT
	,[OCT2011] SMALLINT
	,[NOV2011] SMALLINT
	,[DIC2011] SMALLINT
	,[ENE2012] SMALLINT --DEFAULT 0
	,[FEB2012] SMALLINT --DEFAULT 0
	,[MAR2012] SMALLINT --DEFAULT 0
	,[APR2012] SMALLINT --DEFAULT 0
	,[MAY2012] SMALLINT --DEFAULT 0
	,[JUN2012] SMALLINT --DEFAULT 0
	,[JUL2012] SMALLINT
	,[AGO2012] SMALLINT
	,[SEP2012] SMALLINT
	,[OCT2012] SMALLINT
	,[NOV2012] SMALLINT
	,[DIC2012] SMALLINT
)

SET @rango_size = 10
SET @i = 1 + 2 + 3 + 4 + 5
SET @j = 46 + 47 + 48 + 49 + 50
SET @numero_sorteos = (SELECT x=COUNT(1) FROM dbo.winner (noLock))

WHILE (@i<@j)
	BEGIN
		INSERT #TEMP_RANGO_VALUES SELECT @i, (CASE WHEN @i + @rango_size <= @j THEN @i + @rango_size - 1 ELSE @j END)
		SET @i = @i + @rango_size
	END

DECLARE batch_cursor CURSOR FOR 
SELECT desde, hasta
FROM #TEMP_RANGO_VALUES

OPEN batch_cursor
FETCH NEXT FROM batch_cursor INTO @desde, @hasta
WHILE ( @@fetch_status = 0 )
	BEGIN
	
		INSERT INTO #TEMP_RESULTS ([DESDE], [HASTA], [OCURRENCIA], [% OCURRENCIA], [MARTES (A partir 10/05/2011)], [Viernes (A partir 10/05/2011)], [INVIERNO], [PRIMAVERA], [VERANO], [OTONO], [ABR2004], [MAY2004], [JUN2004], [JUL2004], [AGO2004], [SEP2004], [OCT2004], [NOV2004], [DIC2004], [ENE2005], [FEB2005], [MAR2005], [APR2005], [MAY2005], [JUN2005], [JUL2005], [AGO2005], [SEP2005], [OCT2005], [NOV2005], [DIC2005], [ENE2006], [FEB2006], [MAR2006], [APR2006], [MAY2006], [JUN2006], [JUL2006], [AGO2006], [SEP2006], [OCT2006], [NOV2006], [DIC2006], [ENE2007], [FEB2007], [MAR2007], [APR2007], [MAY2007], [JUN2007], [JUL2007], [AGO2007], [SEP2007], [OCT2007], [NOV2007], [DIC2007], [ENE2008], [FEB2008], [MAR2008], [APR2008], [MAY2008], [JUN2008], [JUL2008], [AGO2008], [SEP2008], [OCT2008], [NOV2008], [DIC2008], [ENE2009], [FEB2009], [MAR2009], [APR2009], [MAY2009], [JUN2009], [JUL2009], [AGO2009], [SEP2009], [OCT2009], [NOV2009], [DIC2009], [ENE2010], [FEB2010], [MAR2010], [APR2010], [MAY2010], [JUN2010], [JUL2010], [AGO2010], [SEP2010], [OCT2010], [NOV2010], [DIC2010], [ENE2011], [FEB2011], [MAR2011], [APR2011], [MAY2011], [JUN2011], [JUL2011], [AGO2011], [SEP2011], [OCT2011], [NOV2011], [DIC2011], [ENE2012], [FEB2012], [MAR2012], [APR2012], [MAY2012], [JUN2012], [JUL2012], [AGO2012], [SEP2012], [OCT2012], [NOV2012], [DIC2012])
		SELECT [DESDE] = @desde, 
				[HASTA] = @hasta, 
				[OCURRENCIA] = COUNT(1), 
				[% OCURRENCIA] = CONVERT(MONEY,COUNT(1)) * 100/@numero_sorteos, 
				[MARTES (A partir 10/05/2011)] = SUM(CASE WHEN [weekday] = 'Tue' AND draw_date >= '2011-05-10 00:00:00' THEN 1 ELSE 0 END), 
				[Viernes (A partir 10/05/2011)] = SUM(CASE WHEN [weekday] = 'Fri' AND draw_date >= '2011-05-10 00:00:00' THEN 1 ELSE 0 END), 
				[INVIERNO] = SUM(CASE WHEN MONTH(draw_date) IN (1,2,12) THEN  1 ELSE 0 END), 
				[PRIMAVERA] = SUM(CASE WHEN MONTH(draw_date) IN (3,4,5) THEN  1 ELSE 0 END), 
				[VERANO] = SUM(CASE WHEN MONTH(draw_date) IN (6,7,8) THEN  1 ELSE 0 END),  
				[OTONO]  = SUM(CASE WHEN MONTH(draw_date) IN (9,10,11) THEN  1 ELSE 0 END),
				[ABR2004] = SUM(CASE WHEN MONTH(draw_date) = 4 AND YEAR(draw_date) = 2004 THEN 1 ELSE 0 END), 
				[MAY2004] = SUM(CASE WHEN MONTH(draw_date) = 5 AND YEAR(draw_date) = 2004 THEN 1 ELSE 0 END),
				[JUN2004] = SUM(CASE WHEN MONTH(draw_date) = 6 AND YEAR(draw_date) = 2004 THEN 1 ELSE 0 END),
				[JUL2004] = SUM(CASE WHEN MONTH(draw_date) = 7 AND YEAR(draw_date) = 2004 THEN 1 ELSE 0 END),
				[AGO2004] = SUM(CASE WHEN MONTH(draw_date) = 8 AND YEAR(draw_date) = 2004 THEN 1 ELSE 0 END),
				[SEP2004] = SUM(CASE WHEN MONTH(draw_date) = 9 AND YEAR(draw_date) = 2004 THEN 1 ELSE 0 END),
				[OCT2004] = SUM(CASE WHEN MONTH(draw_date) = 10 AND YEAR(draw_date) = 2004 THEN 1 ELSE 0 END),
				[NOV2004] = SUM(CASE WHEN MONTH(draw_date) = 11 AND YEAR(draw_date) = 2004 THEN 1 ELSE 0 END),
				[DIC2004] = SUM(CASE WHEN MONTH(draw_date) = 12 AND YEAR(draw_date) = 2004 THEN 1 ELSE 0 END),
				[ENE2005] = SUM(CASE WHEN MONTH(draw_date) = 1 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[FEB2005] = SUM(CASE WHEN MONTH(draw_date) = 2 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[MAR2005] = SUM(CASE WHEN MONTH(draw_date) = 3 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[APR2005] = SUM(CASE WHEN MONTH(draw_date) = 4 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[MAY2005] = SUM(CASE WHEN MONTH(draw_date) = 5 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[JUN2005] = SUM(CASE WHEN MONTH(draw_date) = 6 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[JUL2005] = SUM(CASE WHEN MONTH(draw_date) = 7 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[AGO2005] = SUM(CASE WHEN MONTH(draw_date) = 8 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[SEP2005] = SUM(CASE WHEN MONTH(draw_date) = 9 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[OCT2005] = SUM(CASE WHEN MONTH(draw_date) = 10 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[NOV2005] = SUM(CASE WHEN MONTH(draw_date) = 11 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[DIC2005] = SUM(CASE WHEN MONTH(draw_date) = 12 AND YEAR(draw_date) = 2005 THEN 1 ELSE 0 END),
				[ENE2006] = SUM(CASE WHEN MONTH(draw_date) = 1 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[FEB2006] = SUM(CASE WHEN MONTH(draw_date) = 2 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[MAR2006] = SUM(CASE WHEN MONTH(draw_date) = 3 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[APR2006] = SUM(CASE WHEN MONTH(draw_date) = 4 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[MAY2006] = SUM(CASE WHEN MONTH(draw_date) = 5 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[JUN2006] = SUM(CASE WHEN MONTH(draw_date) = 6 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[JUL2006] = SUM(CASE WHEN MONTH(draw_date) = 7 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[AGO2006] = SUM(CASE WHEN MONTH(draw_date) = 8 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[SEP2006] = SUM(CASE WHEN MONTH(draw_date) = 9 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[OCT2006] = SUM(CASE WHEN MONTH(draw_date) = 10 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[NOV2006] = SUM(CASE WHEN MONTH(draw_date) = 11 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[DIC2006] = SUM(CASE WHEN MONTH(draw_date) = 12 AND YEAR(draw_date) = 2006 THEN 1 ELSE 0 END),
				[ENE2007] = SUM(CASE WHEN MONTH(draw_date) = 1 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END),
				[FEB2007] = SUM(CASE WHEN MONTH(draw_date) = 2 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END),
				[MAR2007] = SUM(CASE WHEN MONTH(draw_date) = 3 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END),
				[APR2007] = SUM(CASE WHEN MONTH(draw_date) = 4 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END),
				[MAY2007] = SUM(CASE WHEN MONTH(draw_date) = 5 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END),
				[JUN2007] = SUM(CASE WHEN MONTH(draw_date) = 6 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END),
				[JUL2007] = SUM(CASE WHEN MONTH(draw_date) = 7 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END), 
				[AGO2007] = SUM(CASE WHEN MONTH(draw_date) = 8 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END), 
				[SEP2007] = SUM(CASE WHEN MONTH(draw_date) = 9 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END), 
				[OCT2007] = SUM(CASE WHEN MONTH(draw_date) = 10 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END), 
				[NOV2007] = SUM(CASE WHEN MONTH(draw_date) = 11 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END), 
				[DIC2007] = SUM(CASE WHEN MONTH(draw_date) = 12 AND YEAR(draw_date) = 2007 THEN 1 ELSE 0 END), 
				[ENE2008] = SUM(CASE WHEN MONTH(draw_date) = 1 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[FEB2008] = SUM(CASE WHEN MONTH(draw_date) = 2 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[MAR2008] = SUM(CASE WHEN MONTH(draw_date) = 3 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[APR2008] = SUM(CASE WHEN MONTH(draw_date) = 4 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[MAY2008] = SUM(CASE WHEN MONTH(draw_date) = 5 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[JUN2008] = SUM(CASE WHEN MONTH(draw_date) = 6 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[JUL2008] = SUM(CASE WHEN MONTH(draw_date) = 7 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[AGO2008] = SUM(CASE WHEN MONTH(draw_date) = 8 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[SEP2008] = SUM(CASE WHEN MONTH(draw_date) = 9 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[OCT2008] = SUM(CASE WHEN MONTH(draw_date) = 10 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[NOV2008] = SUM(CASE WHEN MONTH(draw_date) = 11 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[DIC2008] = SUM(CASE WHEN MONTH(draw_date) = 12 AND YEAR(draw_date) = 2008 THEN 1 ELSE 0 END), 
				[ENE2009] = SUM(CASE WHEN MONTH(draw_date) = 1 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[FEB2009] = SUM(CASE WHEN MONTH(draw_date) = 2 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[MAR2009] = SUM(CASE WHEN MONTH(draw_date) = 3 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[APR2009] = SUM(CASE WHEN MONTH(draw_date) = 4 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[MAY2009] = SUM(CASE WHEN MONTH(draw_date) = 5 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[JUN2009] = SUM(CASE WHEN MONTH(draw_date) = 6 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[JUL2009] = SUM(CASE WHEN MONTH(draw_date) = 7 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[AGO2009] = SUM(CASE WHEN MONTH(draw_date) = 8 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[SEP2009] = SUM(CASE WHEN MONTH(draw_date) = 9 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[OCT2009] = SUM(CASE WHEN MONTH(draw_date) = 10 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[NOV2009] = SUM(CASE WHEN MONTH(draw_date) = 11 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[DIC2009] = SUM(CASE WHEN MONTH(draw_date) = 12 AND YEAR(draw_date) = 2009 THEN 1 ELSE 0 END), 
				[ENE2010] = SUM(CASE WHEN MONTH(draw_date) = 1 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[FEB2010] = SUM(CASE WHEN MONTH(draw_date) = 2 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[MAR2010] = SUM(CASE WHEN MONTH(draw_date) = 3 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[APR2010] = SUM(CASE WHEN MONTH(draw_date) = 4 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[MAY2010] = SUM(CASE WHEN MONTH(draw_date) = 5 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[JUN2010] = SUM(CASE WHEN MONTH(draw_date) = 6 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[JUL2010] = SUM(CASE WHEN MONTH(draw_date) = 7 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[AGO2010] = SUM(CASE WHEN MONTH(draw_date) = 8 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[SEP2010] = SUM(CASE WHEN MONTH(draw_date) = 9 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[OCT2010] = SUM(CASE WHEN MONTH(draw_date) = 10 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[NOV2010] = SUM(CASE WHEN MONTH(draw_date) = 11 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[DIC2010] = SUM(CASE WHEN MONTH(draw_date) = 12 AND YEAR(draw_date) = 2010 THEN 1 ELSE 0 END), 
				[ENE2011] = SUM(CASE WHEN MONTH(draw_date) = 1 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[FEB2011] = SUM(CASE WHEN MONTH(draw_date) = 2 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[MAR2011] = SUM(CASE WHEN MONTH(draw_date) = 3 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[APR2011] = SUM(CASE WHEN MONTH(draw_date) = 4 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[MAY2011] = SUM(CASE WHEN MONTH(draw_date) = 5 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[JUN2011] = SUM(CASE WHEN MONTH(draw_date) = 6 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[JUL2011] = SUM(CASE WHEN MONTH(draw_date) = 7 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[AGO2011] = SUM(CASE WHEN MONTH(draw_date) = 8 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[SEP2011] = SUM(CASE WHEN MONTH(draw_date) = 9 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[OCT2011] = SUM(CASE WHEN MONTH(draw_date) = 10 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[NOV2011] = SUM(CASE WHEN MONTH(draw_date) = 11 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[DIC2011] = SUM(CASE WHEN MONTH(draw_date) = 12 AND YEAR(draw_date) = 2011 THEN 1 ELSE 0 END), 
				[ENE2012] = SUM(CASE WHEN MONTH(draw_date) = 1 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END), 
				[FEB2012] = SUM(CASE WHEN MONTH(draw_date) = 2 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END), 
				[MAR2012] = SUM(CASE WHEN MONTH(draw_date) = 3 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END), 
				[APR2012] = SUM(CASE WHEN MONTH(draw_date) = 4 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END), 
				[MAY2012] = SUM(CASE WHEN MONTH(draw_date) = 5 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END), 
				[JUN2012] = SUM(CASE WHEN MONTH(draw_date) = 6 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END), 
				[JUL2012] = SUM(CASE WHEN MONTH(draw_date) = 7 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END), 
				[AGO2012] = SUM(CASE WHEN MONTH(draw_date) = 8 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END), 
				[SEP2012] = SUM(CASE WHEN MONTH(draw_date) = 9 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END), 
				[OCT2012] = SUM(CASE WHEN MONTH(draw_date) = 10 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END), 
				[NOV2012] = SUM(CASE WHEN MONTH(draw_date) = 11 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END), 
				[DIC2012] = SUM(CASE WHEN MONTH(draw_date) = 12 AND YEAR(draw_date) = 2012 THEN 1 ELSE 0 END)

		FROM dbo.winner (noLock)
		WHERE sum_total BETWEEN @desde AND @hasta
	
		FETCH NEXT FROM batch_cursor INTO @desde, @hasta
	END
CLOSE batch_cursor
DEALLOCATE batch_cursor	
	
SELECT * FROM #TEMP_RESULTS ORDER BY 3 DESC

DROP TABLE #TEMP_RANGO_VALUES
DROP TABLE #TEMP_RESULTS